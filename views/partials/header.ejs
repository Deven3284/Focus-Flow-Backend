<style>
  .camera-feed-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 320px;
    height: 240px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 9999;
    background: #000;
    border: 2px solid #fff;
    transition: transform 0.3s ease;
    cursor: move;
    touch-action: none;
  }

  .camera-feed-container:hover {
    transform: scale(1.05);
  }

  .camera-feed {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .camera-controls {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    padding: 4px;
    display: flex;
    justify-content: center;
  }

  .camera-controls button {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    margin: 0 2px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .camera-controls button:hover {
    background: rgba(255, 255, 255, 0.4);
  }

  .camera-indicator {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #f44336;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% {
      opacity: 1;
    }

    50% {
      opacity: 0.3;
    }

    100% {
      opacity: 1;
    }
  }

  .modal.no-close .modal-dialog {
    pointer-events: auto;
  }

  .modal.no-close .modal-content {
    pointer-events: auto;
  }

  .modal.no-close .btn-close {
    display: none;
  }
</style>
<div ng-controller="HeaderController">
  <header class="navbar navbar-expand-md d-print-none" data-bs-theme="dark">
    <div class="container-xl">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu"
        aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div style="cursor: pointer;" class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3"
        onclick="window.location.reload()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-brand-asana">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M12 7m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
          <path d="M17 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
          <path d="M7 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
        </svg>
        <b>FocusTask</b>
      </div>
      <div class="navbar-nav flex-row order-md-last">
        <div class="nav-item d-none d-md-flex me-3">
          <div class="btn-list">
            <a href="/app/task" class="btn btn-5" rel="noreferrer">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-brand-asana">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 7m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
                <path d="M17 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
                <path d="M7 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
              </svg>
              Goto <b>tasks</b>
            </a>
          </div>
        </div>
        <div class="nav-item dropdown">
          <a href="#" class="nav-link d-flex lh-1 p-0 px-2" data-bs-toggle="dropdown" aria-label="Open user menu">
            <span class="avatar rounded-5" style="background-image: url({{profile.profileImage}})"></span>
            <div class="d-none d-xl-block ps-2">
              <div>{{ profile != null ? profile.name : '--' }}</div>
              <div style="font-size: 11px;" class="mt-1 text-secondary">{{ profile != null ? profile.jobTitle : '--' |
                uppercase }}</div>
            </div>
          </a>
          <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
            <a href="/app/account-settings" class="dropdown-item">Account Settings</a>
            <a ng-click="requestCameraPermission()" class="dropdown-item" ng-if="!hasCameraPermission && profile.role == 'admin'">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-camera">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />
                <path d="M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
              </svg>
              Enable Camera Monitoring
            </a>
            <a ng-click="toggleCamera()" class="dropdown-item" ng-if="hasCameraPermission && profile.role == 'admin'">
              <span ng-if="isCameraOn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="icon icon-tabler icons-tabler-outline icon-tabler-camera-off">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                  <path
                    d="M8.297 4.289a.997 .997 0 0 1 .703 -.289h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v8m-1.187 2.828c-.249 .11 -.524 .172 -.813 .172h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h1c.298 0 .58 -.065 .834 -.181" />
                  <path d="M10.422 10.448a3 3 0 1 0 4.15 4.098" />
                  <path d="M3 3l18 18" />
                </svg>
                Disable Camera
              </span>
              <!-- <span ng-if="!isCameraOn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="icon icon-tabler icons-tabler-outline icon-tabler-camera">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                  <path
                    d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />
                  <path d="M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                </svg>
                Enable Camera
              </span> -->
            </a>
            <div class="dropdown-divider"></div>
            <a ng-click="logout()" class="dropdown-item">Logout</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="camera-feed-container" ng-if="isCameraOn" id="cameraFeedContainer">
    <div class="camera-indicator" title="Camera is active"></div>
    <video id="miniCameraFeed" class="camera-feed" autoplay playsinline></video>
    <div class="camera-controls text-white text-center" style="font-size: 12px;">
      User should start a day with camera monitoring enabled.
      <!-- <button ng-click="captureSnapshot()" title="Take snapshot now">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-camera">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path
            d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 1 0 2 -2" />
          <path d="M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
        </svg>
      </button> -->
      <!-- <button ng-click="toggleCameraFeedSize()" title="Toggle size">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-minimize">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M5 9l4 0l0 -4" />
          <path d="M3 3l6 6" />
          <path d="M5 15l4 0l0 4" />
          <path d="M3 21l6 -6" />
          <path d="M19 9l-4 0l0 -4" />
          <path d="M15 9l6 -6" />
          <path d="M19 15l-4 0l0 4" />
          <path d="M15 15l6 6" />
        </svg>
      </button> -->
      <!-- <button ng-click="stopCamera()" title="Stop camera">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-camera-off">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path
            d="M8.297 4.289a.997 .997 0 0 1 .703 -.289h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v8m-1.187 2.828c-.249 .11 -.524 .172 -.813 .172h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h1c.298 0 .58 -.065 .834 -.181" />
          <path d="M10.422 10.448a3 3 0 1 0 4.15 4.098" />
          <path d="M3 3l18 18" />
        </svg>
      </button> -->
    </div>
  </div>

  <header class="navbar-expand-md">
    <div class="collapse navbar-collapse" id="navbar-menu">
      <div class="navbar">
        <div class="container-xl">
          <div class="row flex-column flex-md-row flex-fill align-items-center">
            <div class="col">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="/app/dashboard">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon icon-tabler icons-tabler-outline icon-tabler-device-desktop">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M3 5a1 1 0 0 1 1 -1h16a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10z" />
                        <path d="M7 20h10" />
                        <path d="M9 16v4" />
                        <path d="M15 16v4" />
                      </svg>
                    </span>
                    <span class="nav-link-title"> Dashboard </span>
                  </a>
                </li>
                <li class="nav-item dropdown" ng-if="profile!=null && profile.role == 'admin'">
                  <a class="nav-link dropdown-toggle" href="#masters" data-bs-toggle="dropdown"
                    data-bs-auto-close="outside" role="button" aria-expanded="false">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon icon-tabler icons-tabler-outline icon-tabler-layout-grid-add">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                        <path d="M14 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                        <path d="M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                        <path d="M14 17h6m-3 -3v6" />
                      </svg>
                    </span>
                    <span class="nav-link-title"> Masters </span>
                  </a>
                  <div class="dropdown-menu">
                    <a class="dropdown-item" href="/admin/masters/users"> Users </a>
                  </div>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#navbar-addons" data-bs-toggle="dropdown"
                    data-bs-auto-close="outside" role="button" aria-expanded="false">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon icon-tabler icons-tabler-outline icon-tabler-brand-asana">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M12 7m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
                        <path d="M17 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
                        <path d="M7 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
                      </svg>
                    </span>
                    <span class="nav-link-title"> Tasks </span>
                  </a>
                  <div class="dropdown-menu">
                    <a class="dropdown-item" href="/app/task"> Today's Task </a>
                    <a class="dropdown-item" href="/app/task-history"> Task History </a>
                  </div>
                </li>
                <li class="nav-item">
                  <a class="nav-link" style="cursor: pointer;" onclick="showTutorialModal()">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon icon-tabler icons-tabler-outline icon-tabler-brand-youtube">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M2 8a4 4 0 0 1 4 -4h12a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-12a4 4 0 0 1 -4 -4v-8z" />
                        <path d="M10 9l5 3l-5 3z" />
                      </svg>
                    </span>
                    <span class="nav-link-title"> <b>Tutorial</b> </span>
                  </a>
                </li>
              </ul>
            </div>
            <div class="col col-md-auto">
              <ul class="navbar-nav">
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Camera Permission Modal -->
  <div class="modal fade no-close" id="cameraPermissionModal" tabindex="-1" aria-labelledby="cameraPermissionModalLabel"
    aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-md modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cameraPermissionModalLabel">Camera Permission Required</h5>
        </div>
        <div class="modal-body">
          <p>Please grant camera access to enable monitoring. Click the button below to request permission.</p>
          <button class="btn btn-primary" ng-click="requestCameraAccess()">Grant Camera Access</button>
          <p ng-if="permissionError" class="text-danger mt-2">{{ permissionError }}</p>
        </div>
      </div>
    </div>
  </div>
</div>



<!-- Tutorial Video Modal -->
<div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="videoModalLabel">Tutorial Video</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <video width="100%" controls>
          <source src="/Uploads/tutorials/video-tutorial-focustask.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
  </div>
</div>